---

- name: "Create directories"
  file:
    path: "{{ item }}"
    state: directory
    force: true
    recurse: true
  loop:
    - "{{ zshenv.XDG_CONFIG_HOME }}/zsh"
    - "{{ zshenv.HISTFILE_DIR_PATH }}"

# link zshrc file
- name: "Link zshrc to {{ zshenv.ZSHRC_PATH }}"
  file:
    src: "{{ zshenv.DOTDIR }}/tools/zsh/.zshrc"
    dest: "{{ zshenv.ZSHRC_PATH }}"
    state: link
    force: true

# link zshenv file
- name: "Link zshenv to {{ zshenv.ZSHENV_PATH }}"
  file:
    src: "{{ zshenv.DOTDIR }}/tools/zsh/.zshenv"
    dest: "{{ zshenv.ZSHENV_PATH }}"
    state: link

# link zshenv file to $HOME
- name: "Link zshenv to {{ zshenv.HOME }}"
  file:
    src: "{{ zshenv.DOTDIR }}/tools/zsh/.zshenv"
    dest: "{{ zshenv.HOME }}/.zshenv"
    state: link

# link zlogin file
- name: "Link zlogin to {{ zshenv.ZLOGIN_PATH }}"
  file:
    src: "{{ zshenv.DOTDIR }}/tools/zsh/.zlogin"
    dest: "{{ zshenv.ZLOGIN_PATH }}"
    state: link

- name: "Link powerlevel10k config to {{ zshenv.ZDOTDIR }}/.p10k.zsh"
  file:
    src: "{{ zshenv.ZSH_THEME_DEFAULT }}"
    dest: "{{ zshenv.ZDOTDIR }}/.p10k.zsh"
    state: link
  when: "'powerlevel10k' in lookup('env', 'ZSH_THEME_DEFAULT')"

- name: "Change default shell to ZSH"
  ansible.builtin.user:
    name: "{{ ansible_env['USER'] }}"
    shell: /usr/bin/zsh
  become: true
